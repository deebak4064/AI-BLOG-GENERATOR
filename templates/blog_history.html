<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Blog History</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .center-box {
            max-width: 800px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 1.5rem;
        }
        .center-box h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            color: var(--primary-color);
        }
        .blog-history-list {
            list-style: disc;
            padding-left: 1.5rem;
            margin: 0;
            flex: 2;
        }
        .blog-history-list li {
            margin-bottom: 1rem;
        }
        .blog-title-link {
            font-size: 1.2rem;
            color: black;
            font-weight: 600;
            text-decoration: none;
        }
        .blog-title-link:hover {
            text-decoration: underline;
        }
        .blog-date {
            display: block;
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.2rem;
        }
        .filter-box {
            flex: 1;
            padding: 1rem;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .filter-box h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        .filter-box label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #333;
        }
        .filter-box select,
        .filter-box button {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .filter-box button {
            background: var(--primary-color);
            color: #fff;
            border: none;
            cursor: pointer;
        }
        .filter-box button:hover {
            background: var(--primary-hover);
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="navbar-content">
            <h1><i class="fas fa-robot"></i> AI Blog Generator</h1>
            <nav class="navbar-nav">
                <a href="/">Generate</a>
                <a href="/blog" class="active">View Blogs</a>
            </nav>
            <div class="navbar-auth">
                {% if current_user.is_authenticated %}
                    <span class="user-info">{{ current_user.username }}</span>
                    <a href="/logout" class="btn btn-secondary btn-sm">Logout</a>
                {% else %}
                    <a href="/login" class="btn btn-primary btn-sm">Login</a>
                {% endif %}
            </div>
        </div>
    </div>
    <main class="main-content">
        <div class="container">
            <div class="center-box">
                <div>
                    <h2>Your Blog History</h2>
                    {% if blogs %}
                        <ul class="blog-history-list">
                            {% for blog in blogs %}
                                <li data-category="{{ blog.category }}">
                                    <a class="blog-title-link" href="/blog/{{ blog.id }}">{{ blog.title }}</a>
                                    <span class="blog-date">{{ blog.created_at }}</span>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-file-alt"></i>
                            <p>No blog history found.</p>
                            <a href="/" class="btn btn-primary">Generate New Blogs</a>
                        </div>
                    {% endif %}
                </div>
                <div class="filter-box">
                    <h3>Filter Blogs</h3>

                    <label for="filter-time">Filter by Time</label>
                    <select id="filter-time" onchange="updateTimeFilterOptions()">
                        <option value="recent">Recent</option>
                        <option value="month">Month</option>
                        <option value="year">Year</option>
                    </select>

                    <div id="time-options" style="margin-top: 1rem; display: none;">
                        <label for="filter-month" style="display: none;" id="month-label">Select Month</label>
                        <select id="filter-month" style="display: none;">
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>

                        <label for="filter-year" style="display: none;" id="year-label">Select Year</label>
                        <select id="filter-year" style="display: none;">
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                        </select>
                    </div>

                    <label for="filter-search">Search Blogs</label>
                    <input type="text" id="filter-search" placeholder="Search by title..." style="width: 100%; padding: 0.5rem; margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 4px;">

                    <label for="filter-category">Filter by Category</label>
                    <select id="filter-category" style="width: 100%; padding: 0.5rem; margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 4px;">
                        <option value="all">All Categories</option>
                        <option value="Tech">Tech</option>
                        <option value="Beauty">Beauty</option>
                        <option value="Education">Education</option>
                        <option value="Gaming">Gaming</option>
                        <option value="Health">Health</option>
                        <option value="Travel">Travel</option>
                        <option value="Lifestyle">Lifestyle</option>
                        <option value="Business">Business</option>
                        <option value="General">General</option>
                    </select>

                    <button onclick="applyFilters()">Apply Filters</button>
                    <button style="margin-top: 1rem; width: 100%; padding: 0.75rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; background-color: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 0.95rem;" onclick="clearAllBlogsWithConfirm()">
                        <i class="fas fa-trash-alt"></i> Clear History
                    </button>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <div class="container">
            <p>&copy; 2025 AI Blog Generator - Made with AI & Human Curation</p>
            <p> Credit : Deebak kumar k</p>
        </div>
    </footer>

    <script>
function updateTimeFilterOptions() {
    const timeFilter = document.getElementById('filter-time').value;
    const monthLabel = document.getElementById('month-label');
    const monthSelect = document.getElementById('filter-month');
    const yearLabel = document.getElementById('year-label');
    const yearSelect = document.getElementById('filter-year');

    if (timeFilter === 'month') {
        monthLabel.style.display = 'block';
        monthSelect.style.display = 'block';
        yearLabel.style.display = 'none';
        yearSelect.style.display = 'none';
    } else if (timeFilter === 'year') {
        monthLabel.style.display = 'none';
        monthSelect.style.display = 'none';
        yearLabel.style.display = 'block';
        yearSelect.style.display = 'block';
    } else {
        monthLabel.style.display = 'none';
        monthSelect.style.display = 'none';
        yearLabel.style.display = 'none';
        yearSelect.style.display = 'none';
    }
}

function applyFilters() {
    const timeFilter = document.getElementById('filter-time').value;
    const monthFilter = parseInt(document.getElementById('filter-month').value);
    const yearFilter = parseInt(document.getElementById('filter-year').value);
    const searchFilter = document.getElementById('filter-search').value.toLowerCase();
    const categoryFilter = document.getElementById('filter-category').value;
    const blogs = document.querySelectorAll('.blog-history-list li');

    const currentDate = new Date();
    blogs.forEach(blog => {
        const dateText = blog.querySelector('.blog-date').textContent.trim();
        const titleText = blog.querySelector('.blog-title-link').textContent.trim().toLowerCase();
        const blogCategory = blog.getAttribute('data-category');
        
        // Parse date format: YYYY-MM-DD HH:MM:SS
        const dateParts = dateText.split(' ')[0].split('-');
        const blogYear = parseInt(dateParts[0]);
        const blogMonth = parseInt(dateParts[1]);
        
        let showByTime = true;
        if (timeFilter === 'month') {
            showByTime = blogMonth === monthFilter && blogYear === currentDate.getFullYear();
        } else if (timeFilter === 'year') {
            showByTime = blogYear === yearFilter;
        }

        let showBySearch = searchFilter === '' || titleText.includes(searchFilter);
        let showByCategory = categoryFilter === 'all' || blogCategory === categoryFilter;

        if (showByTime && showBySearch && showByCategory) {
            blog.style.display = '';
        } else {
            blog.style.display = 'none';
        }
    });
}

function clearAllBlogsWithConfirm() {
    if (confirm('Are you sure you want to delete ALL blogs? This will permanently remove all your blog history. This action cannot be undone.')) {
        clearAllBlogs();
    }
}

function clearAllBlogs() {
    fetch('/api/clear-all-blogs', {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('All blogs deleted successfully');
            location.reload();
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error deleting blogs');
    });
}
    </script>
</body>
</html>
